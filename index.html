<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>test</title>

	<!--
	<script src="/jquery-1.11.0.js"></script>
	<link rel="stylesheet" href="/bootstrap-3.1.1-dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="/bootstrap-3.1.1-dist/css/bootstrap-theme.min.css">
	<script src="/bootstrap-3.1.1-dist/js/bootstrap.min.js"></script>
	-->

	
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

	<script src="./jquery.stream.js"></script>
	<script src="./jquery.media.js"></script>
	<script src="./jquery.draw.js"></script>
	
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	
	<style>
	.tabView .nav-tabs {
		margin-bottom: 15px;
	}
	</style>
	<script>
	$(function(){
		$(".tabView").tab();
	});
	</script>
</head>
<body>
	<div class="tabView">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#tab0" data-toggle="tab">dataURL</a></li>
		</ul>
		<div class="tab-content">
			<div id="tab0" class="tab-pane active">
				<div class="row">
					<div class="col-md-4">
						<form class="form-horizontal">
							<div class="panel panel-default">
								<div class="panel-heading">
									<div class="panel-title">Source file</div>
								</div>
								<div class="panel-body">
									<input type="file" required="required"/>
								</div>
							</div>
							
							<div class="panel panel-default">
								<div class="panel-heading">
									<div class="panel-title">
										Convert
										<input name="convert" type="checkbox" checked="checked" value="1" />
									</div>
								</div>
								<div class="panel-body" data-role="settings">
									<div class="form-group">
										<div class="col-sm-offset-2 col-sm-10">
											<div class="checkbox">
												<label class="control-label">scale
													<input name="scale" type="checkbox" checked="checked" value="1" />
												</label>
											</div>
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-sm-2 control-label">width</label>
										<div class="col-sm-10">
											<input name="width" type="range" min="10" max="300" step="10" value="100" class="form-control"/>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">height</label>
										<div class="col-sm-10">
											<input name="height" type="range" min="10" max="300" step="10" value="100" class="form-control"/>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">maxWidth</label>
										<div class="col-sm-10">
											<input name="maxWidth" type="range" min="10" max="500" step="10" value="100" class="form-control"/>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">maxHeight</label>
										<div class="col-sm-10">
											<input name="maxHeight" type="range" min="10" max="500" step="10" value="100" class="form-control"/>
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-sm-2 control-label">type</label>
										<div class="col-sm-10">
											<select name="type" class="form-control">
												<option value="image/png">image/png</option>
												<option value="image/jpeg">image/jpeg</option>
											</select>
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-sm-2 control-label">(jpeg) quality</label>
										<div class="col-sm-10">
											<input name="quality" type="range" min="0" max="1" step="0.01" value="1" class="form-control"/>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
					
					<div class="col-md-8">
						<div class="tabView">
							<ul class="nav nav-pills">
								<li class="active"><a href="#tab0_info" data-toggle="tab">info</a></li>
								<li><a href="#tab0_url" data-toggle="tab">url</a></li>
							</ul>
							<div class="tab-content">
								<div id="tab0_info" class="tab-pane active">
									<table class="table table-striped table-bordered" style="width:100%">
										<tbody>
											<tr>
												<td><b>type</b></th>
												<td data-bind="type"></td>
											</tr>
											<tr>
												<td><b>rawSize</b></td>
												<td data-bind="rawSize"></td>
											</tr>
											<tr>
												<td><b>size</b></td>
												<td data-bind="size"></td>
											</tr>
											<tr>
												<td><b>image</b></th>
												<td>
													<figure data-bind="url"></figure>
												</td>
											</tr>
										<tbody>
									</table>
								</div>
								<div id="tab0_url" class="tab-pane">
									<table class="table table-striped table-bordered" style="width:100%">
										<tbody>
											<tr>
												<td><b>url</b></td>
												<td><textarea data-bind="url" class="form-control" rows="12"></textarea></td>
											</tr>
										</body>
									</table>
								</div>
							</div>
						</div>
					</div>
					
					<script>
					$(function(){
						var $tab = $("#tab0"),
							$inputSource = $tab.find("input[type='file']"),
							$form = $tab.find("form"),
							$settingConvert = $tab.find("input[name='convert']"),
							$settingType = $tab.find("select[name='type']"),
							$settingQuality = $tab.find("input[name='quality']"),
							$tabView = $tab.find(".tabView"),
							$bindings = $tab.find("[data-bind]");
						
						
						$tab.find("form").on("change", function(){
							var blob = $.blob($inputSource);
							
							var isImage = $.blob.is(blob, "image");
							
							$form.find("input[name],select,textarea").prop("disabled", !isImage);
							
							if (!blob) return;
							
							var options = $.extend.apply($.extend, [{},{async:true}].concat(
								$.map($form.serializeArray(), function(v,i){
									var o = {}; o[v.name] = v.value; return o;
								})
							));
							
							$bindings.empty();
							
							$.dataURL(blob, options)
							.then(function(url){
								var data = {
									url: url,
									type: $.dataURL.type(url),
									size: $.dataURL.size(url, true),
									rawSize: $.dataURL.rawSize(url, true)
								};
								
								$bindings.each(function(){
									var $this = $(this),
										value = data[$this.attr("data-bind")];
									
									if ($this.is("input,select,textarea")) {
										$this.val(value||"");
										
									} else if ($this.is("figure")) {
										$this.empty();
										if (value) {
											$("<img/>")
												.prop("src",value)
												.css("cursor","pointer")
												.appendTo($this)
												.on("click",function(){
													$(this).save();
												})
												.one("load", function(){
													$("<figcaption></figcaption>")
														.text(this.width + " x " + this.height)
														.appendTo($this);
												});
										}
										
									} else {
										$this.empty().text(value||"-");
									}
								});
							})
							
							
						});
						
						$settingConvert.on("change", function(){
							$formSettings.prop("disabled", $(this).prop("checked"));
						});
						
						$settingType.on("change", function(){
							$settingQuality.prop("disabled", $(this).val() !== "image/jpeg");
						})
						.trigger("change");
					});
					</script>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
<!--
Look into:

	Audio API:
	- http://www.html5rocks.com/en/tutorials/webaudio/intro/

	AudioContext API:
	- http://webaudiodemos.appspot.com/AudioRecorder/index.html
	- https://developer.mozilla.org/en-US/docs/Web/API/AudioContext

-->